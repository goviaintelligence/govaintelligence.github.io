<!DOCTYPE HTML>
<html>
	<head>
		<title>USUARIO</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body>
		<!-- Header -->
		<header id="header">
			<h1>Panel de Usuario</h1>
		</header>

		<!-- Main Content -->
		<div class="container">
			<section>
				<h2>Bienvenido</h2>
				<p id="user-info">Cargando datos del usuario...</p>

				<h3>Informes Personalizados</h3>
				<iframe title="Informe Power BI" width="600" height="373.5" src="https://app.powerbi.com/view?r=eyJrIjoiOGZkM2E2MGQtNjVjOC00Nzk2LTk1MDAtYjQ2ZTNlMTM0ZmU4IiwidCI6ImNhNThkMmE2LWViNTAtNDJhNi04MmVmLWYzYzY3NDM4MTZhNSIsImMiOjR9" frameborder="0" allowFullScreen="true"></iframe>
			</section>
		</div>

		<!-- Firebase SDK -->
		<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>

		<script>
			// Configuración de Firebase
			const firebaseConfig = {
				apiKey: "AIzaSyC2VK-Hxs5ak7Cob6eWozaZia4avduk8F4",
				authDomain: "govia-505c5.firebaseapp.com",
				projectId: "govia-505c5",
				storageBucket: "govia-505c5.appspot.com",
				messagingSenderId: "906079889260",
				appId: "1:906079889260:web:d609395d33acc1534e3549"
			};
		
			// Inicializar Firebase
			const app = firebase.initializeApp(firebaseConfig);
			const auth = firebase.auth();
		
			// Manejar el estado de autenticación
			auth.onAuthStateChanged((user) => {
				if (user) {
					// El usuario está autenticado, mostrar su información
					document.getElementById('user-info').innerText = `Bienvenido, ${user.email}`;
				} else {
					// Si no hay usuario autenticado, redirigir a login.html
					console.log("Usuario no autenticado. Redirigiendo a login.html...");
					window.location.href = "/login.html"; // Asegúrate de que esta ruta sea correcta
				}
			});
		
			// Manejo del Google Sign-In con depuración
			document.getElementById('google-signin-btn').addEventListener('click', function() {
				console.log('Botón de Iniciar sesión clickeado');
				const provider = new firebase.auth.GoogleAuthProvider();
				auth.signInWithPopup(provider)
					.then((result) => {
						console.log('Login exitoso, redirigiendo a user.html...');
						// Redirigir a la página de usuario personalizada
						window.location.href = "/user.html";  // Asegúrate de que esta ruta sea correcta
					})
					.catch((error) => {
						console.error("Error al iniciar sesión: ", error);
					});
			});
		</script>
		
	</body>
</html>
